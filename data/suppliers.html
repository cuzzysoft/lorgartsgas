<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> Suppliers | Lorgarts Gas</title>

  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="../plugins/fontawesome-free/css/all.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <link rel="stylesheet" href="../plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
  <link rel="stylesheet" href="../dist/css/adminlte.min.css">

  <!-- Select2 -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="../plugins/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    if (!sessionStorage.getItem('user_data')) {
      window.location.href = 'login.html';
    }
  </script>

  <style>
    .loading-overlay {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.8);
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    .loading-overlay.active {
      display: flex;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    #logoutBtn {
      cursor: pointer;
    }
  </style>

</head>

<body class="hold-transition sidebar-mini layout-fixed text-sm">

  <div id="chartLoading" class="loading-overlay">
    <div class="spinner"></div>
  </div>

  <!-- Site wrapper -->
  <div class="wrapper">
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-light">
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-toggle="modal" data-target="#sell-modal"><img src="img/sell.png"
              style="width:60px;cursor:pointer"></a>
        </li>

        <!--<li class="nav-item d-none d-sm-inline-block">-->
        <!--  <a href="#" class="nav-link">Contact</a>-->
        <!--</li>-->
      </ul>

      <!-- Right navbar links -->
      <ul class="navbar-nav ml-auto text-sm">
        <li class="nav-item">
          <button class="sales-button nav-link" style="color:white" onclick="window.location.href='sales.html'"> Sales
          </button>

        </li>
        <li class="nav-item">
          <a class="nav-link" id="calc" href="#" role="button" data-toggle="modal" title="Calculator"
            data-target="#modal-calculator">
            <i class="fas fa-calculator"></i>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-widget="fullscreen" title="Fullscreen" href="#" role="button">
            <i class="fas fa-expand-arrows-alt"></i>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="logoutBtn" title="Logout">
            <i class="fas fa-sign-out-alt"></i>
          </a>
        </li>
      </ul>
    </nav>

    <aside id="sidebar-container" class="main-sidebar sidebar-dark-primary elevation-4 text-sm"></aside>
    <!-- /.sidebar -->


    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->
      <section class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1>Suppliers</h1>
            </div>
            <div class="col-sm-6">
              <ol class="breadcrumb float-sm-right">
                <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item active">Suppliers</li>
              </ol>
            </div>
          </div>
        </div><!-- /.container-fluid -->
      </section>

      <!-- Main content -->
      <section class="content">
        <div class="container-fluid">
          <div class="row">
            <div class="card card-primary card-outline" style="width: 100%;">
              <div class="card-header">
                <div class="card-tools">
                  <button type="button" class="btn btn-info" data-toggle="modal" data-target="#modal-newuser"><i
                      class="fas fa-plus"></i> Add Supplier</button>
                </div>
              </div>
              <div class="card-body table-responsive " id="catTable">
                <table class="table table-striped projects" id="suppliersTable" style="width: 100%;">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Company</th>
                      <th>Product Sold</th>
                      <th>Address</th>
                      <th>Email</th>
                      <th>Phone</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
              <!-- /.card-body -->
            </div>


          </div>
        </div>
      </section>
      <!-- /.content -->





      <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog">
        <div class="modal-dialog">
          <div class="modal-content">
            <form method="post" action="deleteSupplier.php">

              <div class="modal-header">
                <h4 class="modal-title">Delete</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <p style="text-align: center;">Do you want to delete <span id="namm"></span>? </p>
              <input type="hidden" id="cusid2" name="cusid2">

              <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="submit" name="submit" class="btn btn-primary">Yes</button>
              </div>
            </form>
          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>

      <div class="modal fade" id="modal-newuser">
        <div class="modal-dialog">
          <div class="modal-content">
            <form id="addSupplierForm" enctype="multipart/form-data">
              <div class="modal-header">
                <h4 class="modal-title">Add Supllier</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>

              <div class="modal-body">
                <div class="col-md-12">
                  <div class="card card-primary">

                    <div class="card-body">

                      <div class="form-group">
                        <label for="inputName">Company Name</label>
                        <input type="text" id="company" name="company" required class="form-control">
                      </div>
                      <div class="form-group">
                        <label for="inputName">Company Email</label>
                        <input type="email" id="email" name="email" required class="form-control">
                      </div>
                      <div class="form-group">
                        <label for="inputName"> Phone</label>
                        <input type="text" id="phone" name="phone" required class="form-control">
                      </div>
                      <div class="form-group">
                        <label for="inputName">Address</label>
                        <textarea id="address" name="address" required class="form-control"></textarea>
                      </div>
                      <div class="form-group">
                        <label for="inputName"> Product Sold</label>
                        <select class="form-control" id="productSelect" name="product" required>
                          <option value="">--select--</option>
                        </select>
                      </div>
                    </div>
                    <!-- /.card-body -->

                  </div>
                  <!-- /.card -->
                </div>
              </div>
              <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="submit" name="submit" class="btn btn-primary">Save</button>
              </div>
            </form>
          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>

      <div class="modal fade" id="editmodal">
        <div class="modal-dialog">
          <div class="modal-content">
            <form method="post"  enctype="multipart/form-data">
              <div class="modal-header">
                <h4 class="modal-title">Edit Supplier</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>

              <div class="modal-body">
                <div class="col-md-12">
                  <div class="card card-primary">

                    <div class="card-body">
                      <input type="hidden" id="cusid" name="cusid">
                      <div class="form-group">
                        <label for="inputName">Company Name</label>
                        <input type="text" id="company1" name="company1" required class="form-control">
                      </div>
                      <div class="form-group">
                        <label for="inputName">Company Email</label>
                        <input type="email" id="email1" name="email1" required class="form-control">
                      </div>
                      <div class="form-group">
                        <label for="inputName"> Phone</label>
                        <input type="text" id="phone1" name="phone1" required class="form-control">
                      </div>
                      <div class="form-group">
                        <label for="inputName">Address</label>
                        <textarea id="address1" name="address1" required class="form-control"></textarea>
                      </div>
                      <div class="form-group">
                        <label for="inputName"> Product Sold</label>
                        <select class="form-control" id="productSelectEdit" name="product" required>
                          <option value="">--select--</option>
                        </select>
                      </div>
                    </div>
                    <!-- /.card-body -->

                  </div>
                  <!-- /.card -->
                </div>
              </div>
              <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="submit" name="update" class="btn btn-primary">Update</button>
              </div>
            </form>
          </div>
          <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
      </div>

    </div>
    <input type="hidden" id="unit_pricefill" class="form-control" >
    <div class="modal fade" id="sell-modal">
      <div class="modal-dialog">
        <div class="modal-content">
          <form method="post" id="sellform">
            <div class="modal-header">
              <h4 class="modal-title">Sell</h4>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>

            <div class="modal-body">
              <div class="col-md-12">
                <div class="card card-primary">

                  <div class="card-body">

                    <div class="form-group">
                      <label for="inputName">Customer</label>
                      <select class="form-control" name="customer" id="customer">
                        <option value="">--select customer--</option>
                      </select>

                    </div>

                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label for="inputName"> Date</label>
                          <input type="datetime-local" id="selldate" name="selldate" required class="form-control">
                        </div>

                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label for="inputName"> Quantity (Kg)</label>
                          <input type="number" step="0.01" id="lpg_qty" name="lpg_qty" onkeyup="handleKeyUp(event)"
                            required class="form-control">
                        </div>
                      </div>
                    </div>
                    <input type="hidden" id="hiddenid" name="hiddenid" value="">
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="inputName"> Total Price </label>
                          <input type="text" id="lpg_price" onkeyup="handlePriceKeyUp(event)" name="lpg_price"
                            class="form-control">
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="inputName"> Paid Via</label>
                          <select class="form-control" required name="pvia" id="pvia" onchange="showSelAcc(event)">
                            <option value="">--select--</option>
                            <option value="Cash">Cash</option>
                            <option value="Transfer"> Bank Transfer</option>
                            <option value="POS">POS</option>
                            <option value="Unpaid">Unpaid</option>
                          </select>
                        </div>
                      </div>

                      <div class="col-md-12" id="sel_accdiv" style="display: none;">
                        <div class="form-group">
                          <label for="inputName"> Select Account</label>
                          <select class="form-control" name="sel_acc" id="sel_acc">
                            <option value="">--select--</option>
                          </select>

                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- /.card-body -->

                </div>
                <!-- /.card -->
              </div>
            </div>
            <div class="modal-footer justify-content-between" style="padding-top: 0px; margin-top:0px">
              <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
              <button type="submit" id="selsubmit" name="submit" class="btn btn-primary">Submit</button>
            </div>
          </form>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>


    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
      <!-- Control sidebar content goes here -->
    </aside>
    <footer class="main-footer">
      <div class="float-right d-none d-sm-block">
        <!--<b>Version</b> 1.0-->
      </div>
      <strong>Copyright &copy;
        <span id="footerdate"></span> <a href="index.html">Lorgarts Gas</a>.
      </strong> All rights reserved.
    </footer>
    <!-- /.control-sidebar -->
  </div>
  <!-- ./wrapper -->

  <!-- jQuery -->

  <script>
    $(document).ready(function () {
      $(document).on('click', '.editbtn', function () {

        $('#editmodal').modal('show');
        $tr = $(this).closest('tr');

        var data = $tr.children("td").map(function () {
          return $(this).text();
        }).get();
        $('#company1').val(data[1].trim());
        $('#product1').val(data[2].trim());
        $('#email1').val(data[4].trim());
        $('#phone1').val(data[5].trim());
        $('#cusid').val(data[6].trim());
        $('#address1').val(data[3].trim());

      });

      $('.deletebtn').on('click', function () {

        $('#deleteModal').modal('show');
        $tr = $(this).closest('tr');

        var data = $tr.children("td").map(function () {
          return $(this).text();
        }).get();

        $("#namm").text(data[1].trim());

        $('#cusid2').val(data[6].trim());
      });
       loadSuppliers();
      loadProducts();
    });
  </script>
  <script src="../plugins/jquery/jquery.min.js"></script>
  <script src="../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>

  <script src="../dist/js/adminlte.min.js"></script>
  <script src="../plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
  <script>
    $('.table').on('click', 'tbody tr', function (event) {
      $(this).addClass('highlight').siblings().removeClass('highlight');
    })

   

    function loadProducts() {
      $.ajax({
        url: 'https://lorgartsgas.hotelsoft.ng/php/products_fetch.php',
        type: 'GET',
        dataType: 'json',
        xhrFields: {
          withCredentials: true // ðŸ”‘ REQUIRED for PHP sessions
        },
        crossDomain: true,
        success: function (res) {
          if (!res.status) return;

          let options = '<option value="">--select--</option>';

          $.each(res.data, function (i, p) {
            options += `<option value="${p.id}">${p.product}</option>`;
          });

          $('#productSelect').html(options);
          $('#productSelectEdit').html(options);
        }
      });
    }

    function loadSuppliers() {
      document.getElementById('chartLoading').classList.add('active');
      $.ajax({
        url: 'https://lorgartsgas.hotelsoft.ng/php/suppliers_fetch.php',
        type: 'GET',
        dataType: 'json',
        xhrFields: {
          withCredentials: true // ðŸ”‘ REQUIRED for PHP sessions
        },
        crossDomain: true,
        success: function (res) {
          document.getElementById('chartLoading').classList.remove('active');
          if (!res.status) return;

          let rows = '';

          $.each(res.data, function (i, s) {
            rows += `
                    <tr>
                        <td>${s.sn}</td>
                        <td>${s.company}</td>
                        <td>${s.product ?? ''}</td>
                        <td>${s.address}</td>
                        <td>${s.email}</td>
                        <td>${s.phone}</td>
                        <td>
                            <button class="btn btn-info btn-sm editbtn" data-id="${s.id}">Edit</button>
                            <button class="btn btn-danger btn-sm deletebtn" data-id="${s.id}" data-name="${s.company}">Delete</button>
                        </td>
                    </tr>
                `;
          });

          $('#suppliersTable tbody').html(rows);
        }
      });
    }

    $('#addSupplierForm').on('submit', function (e) {
      e.preventDefault();

      $.ajax({
        url: 'https://lorgartsgas.hotelsoft.ng/php/suppliers_insert.php',
        type: 'POST',
        data: $(this).serialize(),
        dataType: 'json',
        xhrFields: {
          withCredentials: true // ðŸ”‘ REQUIRED for PHP sessions
        },
        crossDomain: true,
        success: function (res) {
          if (res.status) {
            $('#modal-newuser').modal('hide');
            $('body').removeClass('modal-open');
            $('.modal-backdrop').remove();
            loadSuppliers();
          } else {
            alert(res.message);
          }
        }
      });
    });

    $(document).on('click', '.deletebtn', function () {
      const id = $(this).data('id');

      if (!confirm('Delete supplier?')) return;

      $.post('https://lorgartsgas.hotelsoft.ng/php/suppliers_delete.php', { id }, function (res) {
        if (res.status) loadSuppliers();
      }, 'json');
    });


  </script>
  <script src="footer.js"></script>
</body>

</html>