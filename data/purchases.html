<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title> Purchase Orders | Lorgarts Gas </title>
  <link rel="stylesheet" href="../plugins/toastr/toastr.min.css">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="../plugins/fontawesome-free/css/all.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <link rel="stylesheet" href="../plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
  <link rel="stylesheet" href="../dist/css/adminlte.min.css">

  <!-- Select2 -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="../plugins/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>



    function viewDay() {
      var location = $("#selectid").val();
      var date = $('#day_date').val().split("-");

      day = date[2];
      month = date[1];
      year = date[0];
      type = "day";
      data(location, year, month, day, type)
    }

    function selectDate2() {
      var strUser = $("#selectdate").val();
      $("#productsort").prop('selectedIndex', 0);
      if (strUser == "Day") {
        $("#day_div").show();
        $("#day_div2").hide()
      } else if (strUser == "Range") {
        $("#day_div").show();
        $("#day_div2").show();
      } else {
        $("#day_div").hide();
        $("#day_div2").hide();

        let xhr = new XMLHttpRequest();
        xhr.open("GET", "http://worldtimeapi.org/api/timezone/Africa/Lagos");
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4) {
            let onlinetime = JSON.parse(xhr.responseText).datetime.substring(0, 19).split("T")[0];
            let parts = onlinetime.split('-');
            var currenttime = new Date(parts[0], parts[1] - 1, parts[2]);

            if (strUser == "Yesterday") {
              currenttime.setDate(currenttime.getDate() - 1);
            }
            var location = $("#selectid").val();
            var day = currenttime.getDate();
            var mont = currenttime.getMonth() + 1;
            var yr = currenttime.getFullYear();
            var type = "All";
            data(location, yr, mont, day, type);
          }
        };
        xhr.send();
      }
    }


    function data(location, yr, mont, day, type) {
      $.ajax({
        type: "POST",
        url: "https://lorgartsgas.hotelsoft.ng/php/get_main_purchases.php",
        data: {
          location: location,
          yr: yr,
          mont: mont,
          day: day,
          type: type
        },

        dataType: "json",
        beforeSend: function () {
          $(".overlay").show();
        },
        complete: function () {
          $(".overlay").hide();
        },
        success: function (response) {
          console.log(response);
          $('#userinfo').DataTable({
            "bAutoWidth": false,
            "bDestroy": true,
            "aaData": response,
            "columnDefs":
              [
                {
                  "targets": [7],
                  "visible": false
                }
              ],
            "columns": [{
              "data": "cnt"
            }, {
              "data": "pid"
            },
            {
              "data": "date"
            },
            {
              "data": "supplier"
            },
            {
              "data": "product"
            },
            {
              "data": "qty"
            },
            {
              "data": "price"
            }


              ,
            {
              "data": "rid"
            }

            ],
            "searching": false,
            "buttons": [
              {
                extend: 'print',
                footer: true
              },
              {
                extend: 'excelHtml5',
                footer: true
              }
            ]
          }).buttons().container().appendTo('#userinfo_wrapper .col-md-6:eq(1)');
        }
      });
    }

    function fillLocationData() {
      // $("#day_div").hide();
      // $("#day_div2").hide();

      $("#selectdate").prop('selectedIndex', 0);

      let xhr = new XMLHttpRequest();
      xhr.open("GET", "http://worldtimeapi.org/api/timezone/Africa/Lagos");
      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
          let currenttime = JSON.parse(xhr.responseText).datetime.substring(0, 19).split("T")[0];

          let day = currenttime.split("-")[2];
          let mont = currenttime.split("-")[1];
          let yr = currenttime.split("-")[0];
          let type = "All";
          let location = $("#selectid").val();
          data(location, yr, mont, day, type);
        }
      };
      xhr.send();
    }

    function fillLocationData() {
      // Hide elements if needed
      // $("#day_div").hide();
      // $("#day_div2").hide();

      $("#selectdate").prop('selectedIndex', 0);

      // Use Fetch API to call the PHP script
      fetch('https://lorgartsgas.hotelsoft.ng/php/get_date.php') // Replace with the path to your PHP script
        .then(response => response.text())
        .then(currentDate => {
          let [yr, mont, day] = currentDate.split('-');

          let type = "All";
          let location = $("#selectid").val();

          // Call the data function with the fetched date values
          data(location, yr, mont, day, type);
        })
        .catch(error => console.error('Error fetching date:', error));
    }


  </script>
</head>

<body class="hold-transition sidebar-mini layout-fixed text-sm">
  <!-- Site wrapper -->
  <div class="wrapper">

    <nav class="main-header navbar navbar-expand navbar-light">
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-toggle="modal" data-target="#sell-modal"><img src="img/sell.png"
              style="width:60px;cursor:pointer"></a>
        </li>

        <!--<li class="nav-item d-none d-sm-inline-block">-->
        <!--  <a href="#" class="nav-link">Contact</a>-->
        <!--</li>-->
      </ul>

      <!-- Right navbar links -->
      <ul class="navbar-nav ml-auto text-sm">
        <li class="nav-item">
          <button class="sales-button nav-link" style="color:white" onclick="window.location.href='sales.html'"> Sales
          </button>

        </li>
        <li class="nav-item">
          <a class="nav-link" id="calc" href="#" role="button" data-toggle="modal" title="Calculator"
            data-target="#modal-calculator">
            <i class="fas fa-calculator"></i>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-widget="fullscreen" title="Fullscreen" href="#" role="button">
            <i class="fas fa-expand-arrows-alt"></i>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="outa.php" title="Logout" onclick="return confirm('Do you want to logout?')">
            <i class="fas fa-sign-out-alt"></i>
          </a>
        </li>
      </ul>
    </nav>

    <aside id="sidebar-container" class="main-sidebar sidebar-dark-primary elevation-4 text-sm"></aside>
    <!-- /.sidebar -->


    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->
      <section class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1> Purchases Orders</h1>
            </div>
            <div class="col-sm-6">
              <ol class="breadcrumb float-sm-right">
                <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item">Stock Information</li>
                <li class="breadcrumb-item active">Purchase Orders</li>
              </ol>
            </div>
          </div>
        </div><!-- /.container-fluid -->
      </section>
      <!-- <?php include('container_fluid.php'); ?> -->
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-12">
            <!-- <div class=" "> -->
            <div class="card-header  id_100">

              <div class="card-tools"><a href="#"><button type="button" style="margin-left: 1em;" data-toggle="modal"
                    data-target="#modal-newuser" class="btn btn-info"><i class="fas fa-plus"></i> Create
                    Order</button></a></div>



              <div class="card-tools" style="margin-left: 1em;display:none;" id="day_div2">
                <input type="date" class="form-control" id="day_date2">
              </div>
              <div class="card-tools" style="margin-left: 1em;display:none;" id="day_div" onchange="viewDay()">
                <input type="date" class="form-control" id="day_date">
              </div>
              <div class="card-tools">
                <select class="form-control custom-select" required id="selectdate" onchange="selectDate2()">
                  <option value="Today" selected>All</option>
                  <option value="Yesterday">Yesterday</option>
                  <option value="Day">Day</option>
                  <option value="Range">Range</option>
                </select>
              </div>
              <div class="card-tools" style="margin-right: 1em; margin-top: 0.5em;">
                Sort :
              </div>
            </div>
            <!-- </div> -->
          </div>
        </div>
      </div>
      <!-- Main content -->
      <section class="content">
        <p style="color:green" id="noti"></p>

        <div class="card">
          <!-- <div class="card-header">
            <h3 class="card-title" id="huy">Pump Sales</h3>
          </div> -->
          <!-- /.card-header -->
          <div class="card-body table-responsive">
            <table id="userinfo" class="table table-bordered table-striped " style="width: 100%;">
              <thead>
                <tr>

                  <th style="width: 2em"> # </th>
                  <th> Order ID</th>
                  <th style="text-align: center;">Date</th>
                  <th style="text-align: center;"> Supplier </th>
                  <th style="text-align: center;">Product</th>
                  <th style="text-align: center;">Qty (Kg)</th>
                  <th style="text-align: center;">Price</th>

                  <!-- <th> Action</th> -->
                  <th> </th>
                </tr>
              </thead>


            </table>
          </div>
          <!-- /.card-body -->
        </div>

      </section>
      <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <form method="post" action="deletePurchase.php">

            <div class="modal-header">
              <h4 class="modal-title">Delete</h4>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <p style="text-align: center;">Do you want to delete <span id="namm"></span>? </p>
            <input type="hidden" id="cusid2" name="cusid2">

            <div class="modal-footer justify-content-between">
              <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
              <button type="submit" name="submit" class="btn btn-primary">Yes</button>
            </div>
          </form>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>

    <div class="modal fade" id="modal-newuser">
      <div class="modal-dialog">
        <div class="modal-content">
          <form method="post" id="add_purchase">
            <div class="modal-header">
              <h4 class="modal-title">Add Purchase</h4>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>

            <div class="modal-body">
              <div class="col-md-12">
                <div class="card card-primary">

                  <div class="card-body">

                    <div class="form-group">
                      <label for="inputName">Supplier</label>

                      <select class="form-control" required name="supplier" id="supplier">
                        <option value="">--select supplier--</option>
                      </select>

                    </div>

                    <div class="form-group" >
                      <label for="inputName">Product</label>

                      <select class="form-control" required name="product" id="product">
                        <option value="">--select product--</option>
                      </select>

                    </div>


                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="inputName"> Quantity (Kg)</label>
                          <input type="number" id="qty" name="qty" required class="form-control">
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="inputName"> Total Price </label>
                          <input type="number" id="price" name="price" required class="form-control">
                        </div>
                      </div>

                    </div>

                    <div class="row">

                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="inputName"> Receiving Tank</label>
                          <select class="form-control" required name="tank" id="tank">
                            <option disabled value="">--select--</option>
                          </select>

                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="inputName">Payment Source</label>
                          <select class="form-control" name="psource" id="psource">
                            <option value="">--select--</option>
                            <option value="cash">Cash at Hand</option>
                            <option value="bank"> Bank Account</option>
                          </select>
                        </div>
                      </div>
                    </div>


                    <div class="row">


                      <div class="col-md-6">
                        <div class="form-group">
                          <p id="cshbl" style="margin-top:2.5em;display: none;">Cash Balance:
                            <?php 
                         $res = mysqli_query($conn, "SELECT cash FROM cash_at_hand where location =10");
                         if ($roww = mysqli_fetch_assoc($res)) {
                           echo number_format($roww['cash']) ;
                         } ?>
                          </p>
                        </div>
                      </div>

                    </div>


                  </div>
                  <!-- /.card-body -->

                </div>
                <!-- /.card -->
              </div>
            </div>
            <div class="modal-footer justify-content-between" style="padding-top: 0px; margin-top:0px">
              <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
              <button type="submit" name="submit" class="btn btn-primary">Submit</button>
            </div>
          </form>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>

    <div class="modal fade" id="eeditModal" tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <form method="post" action="editaddToTank.php">

            <div class="modal-header">
              <h4 class="modal-title">Edit Purchase</h4>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>

            <div class="modal-body">
              <div class="col-md-12">
                <div class="card card-primary">

                  <div class="card-body">
                    <div class="form-group">
                      <label for="inputName">Supplier</label>
                      <select class="form-control" required name="suppliere" id="suppliere">
                        <option value="">--select--</option>
                        <?php $res = mysqli_query($conn, "SELECT id, company FROM suppliers ");
                        while ($roww = mysqli_fetch_assoc($res)) {
                          echo '<option value="' . $roww['id'] . '">' . $roww['company'] . '</option>';
                        } ?>
                      </select>
                    </div>
                    <div class="form-group" id="purchasetanke">
                      <label for="inputName"> Tank/Product</label>
                      <select class="form-control" required name="ptanke" id="ptanke">
                        <option value="">--select--</option>

                      </select>
                      <div id="qtyrem" style="color:blue"></div>
                    </div>
                    <div class="form-group">
                      <label for="inputName"> Quantity</label>
                      <input type="text" id="qtye" name="qtye" required class="form-control">
                    </div>

                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="inputName"> Delivery Truck Type</label>
                          <select class="form-control" required id="ttype">
                            <option value="Company Truck">Company Truck</option>
                            <option value="External Truck">External Truck</option>
                          </select>
                        </div>
                      </div>
                      <div class="col-md-6" id="ourplate">
                        <div class="form-group">
                          <label for="inputName"> Plate Number</label>
                          <select class="form-control" required name="selectplatee" id="selectplatee">
                            <option value="">-select truck--</option>
                            <?php 
                        $rg = mysqli_query($conn,"select id, model,plate_number from trucks");
                        while($rj = mysqli_fetch_assoc($rg)){?>
                            <option value="<?php echo $rj['id'] ?>">
                              <?php echo $rj['model'].' ('.$rj['plate_number'].')' ?>
                            </option>
                            <?php }
                        ?>

                          </select>
                        </div>
                      </div>
                      <div class="col-md-6" id="otherplate" style="display:none">
                        <div class="form-group">
                          <label for="inputName"> Plate Number</label>
                          <input type="text" id="inputplatee" name="inputplatee" class="form-control">
                        </div>
                      </div>

                    </div>
                    <div class="form-group">
                      <label for="inputName">Delivery Status</label>
                      <select class="form-control" required name="statuse" id="statuse">
                        <option value="Pending">Pending</option>
                        <option value="Delivered">Delivered</option>
                      </select>
                    </div>
                    <input type="hidden" id="ide" name="ide">
                  </div>
                  <!-- /.card-body -->

                </div>
                <!-- /.card -->
              </div>
            </div>

            <div class="modal-footer justify-content-between">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button type="submit" name="submit" class="btn btn-primary">Update</button>
            </div>
          </form>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>
    <div class="modal fade" id="sell-modal">
      <div class="modal-dialog">
        <div class="modal-content">
          <form method="post" id="sellform">
            <div class="modal-header">
              <h4 class="modal-title">Sell</h4>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>

            <div class="modal-body">
              <div class="col-md-12">
                <div class="card card-primary">

                  <div class="card-body">

                    <div class="form-group">
                      <label for="inputName">Customer</label>
                      <select class="form-control" name="customer" id="customer">
                        <option value="">--select customer--</option>
                      </select>

                    </div>

                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label for="inputName"> Date</label>
                          <input type="datetime-local" id="selldate" name="selldate" required class="form-control">
                        </div>

                      </div>
                    </div>

                    <div class="row">
                      <div class="col-md-12">
                        <div class="form-group">
                          <label for="inputName"> Quantity (Kg)</label>
                          <input type="number" step="0.01" id="lpg_qty" name="lpg_qty" onkeyup="handleKeyUp(event)"
                            required class="form-control">
                        </div>
                      </div>
                    </div>
                    <input type="hidden" id="hiddenid" name="hiddenid" value="">
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="inputName"> Total Price </label>
                          <input type="text" id="lpg_price" onkeyup="handlePriceKeyUp(event)" name="lpg_price"
                            class="form-control">
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                          <label for="inputName"> Paid Via</label>
                          <select class="form-control" required name="pvia" id="pvia" onchange="showSelAcc(event)">
                            <option value="">--select--</option>
                            <option value="Cash">Cash</option>
                            <option value="Transfer"> Bank Transfer</option>
                            <option value="POS">POS</option>
                            <option value="Unpaid">Unpaid</option>
                          </select>
                        </div>
                      </div>

                      <div class="col-md-12" id="sel_accdiv" style="display: none;">
                        <div class="form-group">
                          <label for="inputName"> Select Account</label>
                          <select class="form-control" name="sel_acc" id="sel_acc">
                            <option value="">--select--</option>
                          </select>

                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- /.card-body -->

                </div>
                <!-- /.card -->
              </div>
            </div>
            <div class="modal-footer justify-content-between" style="padding-top: 0px; margin-top:0px">
              <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
              <button type="submit" id="selsubmit" name="submit" class="btn btn-primary">Submit</button>
            </div>
          </form>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>
    <footer class="main-footer">
      <div class="float-right d-none d-sm-block">
        <!--<b>Version</b> 1.0-->
      </div>
      <strong>Copyright &copy;
        <span id="footerdate"></span> <a href="index.html">Lorgarts Gas</a>.
      </strong> All rights reserved.
    </footer>

    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
      <!-- Control sidebar content goes here -->
    </aside>
    <!-- /.control-sidebar -->
  </div>
  <!-- ./wrapper -->


  <script>
    $(document).ready(function () {
      $("#ttype").on("change", function () {
        $('#inputplate').val('');
        if ($(this).val() == "Company Truck") {
          $("#ourplate").show();
          $("#otherplate").hide();

          $('#inputplate').removeAttr('required');
          $('#selectplate').attr('required', 'required');
        } else {
          $("#ourplate").hide();
          $("#otherplate").show();

          $('#selectplate').removeAttr('required');
          $('#inputplate').attr('required', 'required');
        }

      });

      $("#psource").on("change", function () {
        if ($(this).val() == 'cash') {
          $('#cshbl').show();
        } else {
          $('#cshbl').hide();
        }
      });
      loadSuppliers();
      loadProducts();
      loadTanks(10);
    });
  </script>


  <script src="../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../plugins/datatables/jquery.dataTables.min.js"></script>
  <script src="../plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
  <script src="../plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
  <script src="../plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
  <script src="../plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
  <script src="../plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
  <script src="../plugins/jszip/jszip.min.js"></script>
  <script src="../plugins/pdfmake/pdfmake.min.js"></script>
  <script src="../plugins/pdfmake/vfs_fonts.js"></script>
  <script src="../plugins/datatables-buttons/js/buttons.html5.min.js"></script>
  <script src="../plugins/datatables-buttons/js/buttons.print.min.js"></script>
  <script src="../plugins/datatables-buttons/js/buttons.colVis.min.js"></script>
  <script src="../dist/js/adminlte.min.js"></script>
  <script src="../plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
  <script>
    $('.table').on('click', 'tbody tr', function (event) {
      $(this).addClass('highlight').siblings().removeClass('highlight');
    })
  </script>

  <script>
    $(function () {
      fillLocationData();
    });

    // Edit button click event
    $(document).on("click", '.editbtn', function (event) {
      let $tr = $(this).closest('tr');
      let data = $tr.children("td").map(function () {
        return $(this).text();
      }).get();

      if (data[6].trim() === "Delivered") {
        alert("Unable to edit. Product already delivered to tank");
      } else {

        let currentRow = $(this).closest("tr");
        let rowData = $('#userinfo').DataTable().row(currentRow).data();

        $('#eeditModal').modal('show');
        $("#suppliere").val(data[1].trim());
        $("#ptanke").val(data[2].trim());
        $('#qtye').val(data[3].trim());
        $("#paid_statuse").val(data[4].trim());
        $("#statuse").val(data[5].trim());
        $('#ide').val(rowData['rid']);

      }
    });

    // Get tank quantity
    function gett() {
      let location = $("#ptank").val();
      $.ajax({
        type: "POST",
        url: "https://lorgartsgas.hotelsoft.ng/php/gettankqty.php",
        data: { location: location },
        dataType: "html",
        success: function (response) {
          $("#currqty").val(response);
        },
        error: function (jqXHR, textStatus, errorThrown) {
          alert(`Failed to fetch tank quantity. Error: ${textStatus} - ${errorThrown}`);
        }
      });
    }

    // Delete button click event
    $(document).on("click", '.deletebtn', function (event) {
      let $tr = $(this).closest('tr');
      let data = $tr.children("td").map(function () {
        return $(this).text();
      }).get();

      if (data[6].trim() === "Delivered") {
        alert("Unable to delete. Product already in tank");
      } else {

        $('#deleteModal').modal('show');
        $("#namm").text(data[7].trim());
        $('#cusid2').val(data[9].trim());

      }
    });

    // Handle tank selection change
    $(document).on("change", '#ptank', function (event) {
      gett();
    });


    $("#add_purchase").on("submit", function (e) {
      e.preventDefault();

      $.ajax({
        url: 'https://lorgartsgas.hotelsoft.ng/php/purchase.php',
        type: 'POST',
        data: $(this).serialize(),
        dataType: "json",
        success: function (response) {
          console.log(response);
          if (response.status === "Success") {
            alert("Purchase added successfully");
            $('#add_purchase')[0].reset();
            location.reload();
          } else {
            alert(`Failed: ${response.msg}`);
          }
        },
        error: function (jqXHR, textStatus, errorThrown) {
          console.log(`AJAX Error: ${textStatus} - ${errorThrown}`);
        }
      });
    });


    function loadSuppliers() {
      $.ajax({
        url: 'https://lorgartsgas.hotelsoft.ng/php/get_suppliers.php',
        type: 'GET',
        dataType: 'json',
        success: function (response) {
          if (response.status === 'success') {
            let options = '<option value="">--select supplier--</option>';
            response.data.forEach(s => {
              options += `<option value="${s.id}">${s.company}</option>`;
            });
            $('#supplier').html(options);
          } else {
            alert('Failed to load suppliers');
          }
        },
        error: function () {
          alert('Error loading suppliers');
        }
      });
    }

    function loadProducts() {
      $.ajax({
        url: 'https://lorgartsgas.hotelsoft.ng/php/get_pproducts.php',
        type: 'GET',
        dataType: 'json',
        success: function (response) {
          if (response.status === 'success') {
            let options = '<option value="">--select product--</option>';
            response.data.forEach(p => {
              options += `<option value="${p.id}">${p.product}</option>`;
            });
            $('#product').html(options);
          } else {
            alert('Failed to load products');
          }
        },
        error: function () {
          alert('Error loading products');
        }
      });
    }

    // Load when modal opens or page ready
    $('#sell-modal').on('shown.bs.modal', function () {
      if ($('#supplier option').length === 1) loadSuppliers();
      if ($('#product option').length === 1) loadProducts();
    });



    function loadTanks(location = 10, selectedTankId = null) {
      $.ajax({
        url: 'https://lorgartsgas.hotelsoft.ng/php/get_tanks.php',
        type: 'GET',
        data: { location: location },
        dataType: 'json',
        success: function (response) {
          if (response.status === 'success') {
            let options = '<option disabled value="">--select--</option>';
            response.data.forEach(t => {
              options += `<option value="${t.id}" ${selectedTankId == t.id ? 'selected' : ''}>${t.name}</option>`;
            });
            $('#tank').html(options);
          } else {
            alert('Failed to load tanks');
          }
        },
        error: function () {
          alert('Error loading tanks');
        }
      });
    }

    // Load when modal opens
    $('#sell-modal').on('shown.bs.modal', function () {
      if ($('#tank option').length === 1) loadTanks(10); // default location = 10
    });



  </script>
  <script src="footer.js"></script>
</body>

</html>